# 头像服装位置调整功能指南

## 功能概述

新增的头像服装位置调整功能允许用户在合成预览时精确调整头像和服装的位置，提供更灵活的合成控制。

## 主要功能

### 1. 位置调整模式
- 点击"调整位置"按钮进入调整模式
- 调整模式下按钮变为蓝色，显示"完成调整"
- 再次点击可退出调整模式

### 2. 拖拽控制点
- **蓝色圆点**：控制头像位置，显示"头"字标识
- **绿色圆点**：控制服装位置，显示"衣"字标识
- 支持鼠标拖拽实时调整位置

### 3. 位置限制
- 自动限制拖拽范围，防止元素超出画布边界
- 头像位置限制：X轴 10%-90%，Y轴 5%-90%
- 服装位置限制：X轴 10%-90%，Y轴 5%-90%

### 4. 重置功能
- "重置位置"按钮可快速恢复到默认位置
- 默认位置：
  - 头像：居中偏上 (50%, 6%)
  - 服装：居中偏下 (50%, 40%)

## 使用步骤

1. **选择图片**
   - 选择头像图片（预设或上传）
   - 选择服装图片（预设或上传）

2. **合成预览**
   - 点击"合成预览"生成初始合成图

3. **调整位置**
   - 点击"调整位置"进入调整模式
   - 拖拽蓝色圆点调整头像位置
   - 拖拽绿色圆点调整服装位置
   - 位置变化时自动重新合成

4. **完成调整**
   - 点击"完成调整"退出调整模式
   - 或点击"重置位置"恢复默认位置

5. **设为输入**
   - 点击"设为输入"将调整后的合成图作为生成输入

## 技术实现

### 状态管理
```typescript
interface Position {
  x: number  // 相对位置 (0-1)
  y: number  // 相对位置 (0-1)
}

interface Size {
  width: number   // 相对尺寸 (0-1)
  height: number  // 相对尺寸 (0-1)
}
```

### 拖拽逻辑
- 使用全局鼠标事件监听器处理拖拽
- 实时计算相对位置并更新状态
- 自动重新合成以显示调整效果

### 性能优化
- 使用 `useCallback` 优化事件处理函数
- 使用 `useEffect` 监听位置变化并重新合成
- 拖拽时实时更新，提供流畅的用户体验

## 注意事项

1. **浏览器兼容性**
   - 支持所有现代浏览器的鼠标事件
   - 建议使用Chrome、Firefox、Safari等主流浏览器

2. **性能考虑**
   - 拖拽时会频繁重新合成，建议在性能较好的设备上使用
   - 合成图片尺寸为1024x1024，确保高质量输出

3. **用户体验**
   - 调整模式下会显示操作提示
   - 拖拽控制点有视觉反馈
   - 位置变化实时可见

## 未来改进

1. **尺寸调整**
   - 添加头像和服装尺寸的调整功能
   - 支持缩放控制点

2. **旋转功能**
   - 添加头像和服装的旋转调整
   - 支持角度控制

3. **预设位置**
   - 添加常用位置的预设选项
   - 支持保存自定义位置

4. **触摸支持**
   - 添加移动设备的触摸拖拽支持
   - 优化移动端用户体验
